<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚¢ãƒ«ãƒãƒ ä½œæˆãƒ»å…±æœ‰ã‚¢ãƒ—ãƒª</title>
    <style>
        :root {
            --primary-color: #4a6fa5;
            --secondary-color: #6b8cbc;
            --light-color: #f5f5f5;
            --dark-color: #333;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f9f9f9;
            color: var(--dark-color);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background-color: var(--primary-color);
            color: white;
            padding: 1rem 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        header h1 {
            margin-bottom: 0;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .user-info span {
            font-weight: bold;
        }
        
        nav ul {
            display: flex;
            justify-content: center;
            list-style: none;
            flex-wrap: wrap;
            margin-top: 10px;
        }
        
        nav li {
            margin: 5px 15px;
        }
        
        nav a {
            color: white;
            text-decoration: none;
            padding: 5px 10px;
            border-radius: 4px;
            transition: background-color 0.3s;
        }
        
        nav a:hover, nav a.active {
            background-color: rgba(255,255,255,0.2);
        }
        
        .tab-content {
            display: none;
            padding: 20px 0;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .btn {
            display: inline-block;
            background: var(--primary-color);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
            text-decoration: none;
        }
        
        .btn:hover {
            background: var(--secondary-color);
        }
        
        .btn-danger {
            background: var(--danger-color);
        }
        
        .btn-danger:hover {
            background: #c82333;
        }
        
        .btn-success {
            background: var(--success-color);
        }
        
        .btn-success:hover {
            background: #218838;
        }
        
        .btn-warning {
            background: var(--warning-color);
            color: var(--dark-color);
        }
        
        .btn-warning:hover {
            background: #e0a800;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        input[type="text"],
        input[type="email"],
        input[type="password"],
        textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        
        .upload-area {
            border: 2px dashed #ddd;
            border-radius: 8px;
            padding: 40px 20px;
            text-align: center;
            margin-bottom: 20px;
            cursor: pointer;
            transition: border-color 0.3s;
        }
        
        .upload-area:hover {
            border-color: var(--primary-color);
        }
        
        .upload-area i {
            font-size: 48px;
            color: #ddd;
            margin-bottom: 10px;
        }
        
        .image-preview {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 20px;
        }
        
        .preview-item {
            position: relative;
            width: 150px;
            height: 150px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .preview-item .remove {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(255,255,255,0.8);
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .album-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .album-card {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }
        
        .album-card:hover {
            transform: translateY(-5px);
        }
        
        .album-thumbnail {
            height: 180px;
            overflow: hidden;
        }
        
        .album-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .album-info {
            padding: 15px;
        }
        
        .album-info h3 {
            margin-bottom: 10px;
            font-size: 18px;
        }
        
        .album-info p {
            color: #666;
            font-size: 14px;
            margin-bottom: 15px;
        }
        
        .album-actions {
            display: flex;
            justify-content: space-between;
        }
        
        .share-options {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .share-btn {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 8px 15px;
            border-radius: 4px;
            color: white;
            text-decoration: none;
            font-size: 14px;
        }
        
        .twitter {
            background: #1DA1F2;
        }
        
        .facebook {
            background: #4267B2;
        }
        
        .line {
            background: #00B900;
        }
        
        .copy-link {
            background: #6c757d;
            border: none;
            cursor: pointer;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            border-radius: 8px;
            max-width: 500px;
            width: 90%;
            padding: 20px;
            position: relative;
        }
        
        .close-modal {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
        }
        
        .album-view {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 20px;
        }
        
        .album-images {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
        }
        
        .album-images img {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .album-details {
            padding: 15px;
            background: #f5f5f5;
            border-radius: 8px;
        }
        
        .shared-album-view {
            text-align: center;
            padding: 20px;
        }
        
        .shared-album-title {
            margin-bottom: 20px;
            color: var(--primary-color);
        }
        
        .shared-album-images {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .shared-album-images img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .shared-album-description {
            margin: 20px 0;
            font-size: 18px;
            color: #555;
        }
        
        .shared-album-meta {
            color: #777;
            margin-bottom: 20px;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }
        
        .empty-state i {
            font-size: 48px;
            margin-bottom: 15px;
            display: block;
        }
        
        .auth-forms {
            max-width: 400px;
            margin: 0 auto;
        }
        
        .auth-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }
        
        .auth-tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            flex: 1;
            text-align: center;
        }
        
        .auth-tab.active {
            border-bottom-color: var(--primary-color);
            font-weight: bold;
        }
        
        .auth-form {
            display: none;
        }
        
        .auth-form.active {
            display: block;
        }
        
        .alert {
            padding: 10px 15px;
            border-radius: 4px;
            margin-bottom: 15px;
        }
        
        .alert-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 10px;
            }
            
            .album-view {
                grid-template-columns: 1fr;
            }
            
            .album-grid {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }
            
            .shared-album-images {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <h1>ã‚¢ãƒ«ãƒãƒ ä½œæˆãƒ»å…±æœ‰ã‚¢ãƒ—ãƒª</h1>
                <div class="user-info" id="user-info">
                    <!-- ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã«ã‚ˆã£ã¦è¡¨ç¤ºãŒå¤‰ã‚ã‚Šã¾ã™ -->
                </div>
            </div>
            <nav>
                <ul id="nav-tabs">
                    <!-- ã‚¿ãƒ–ã¯ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã«ã‚ˆã£ã¦å¤‰ã‚ã‚Šã¾ã™ -->
                </ul>
            </nav>
        </div>
    </header>

    <main class="container">
        <!-- èªè¨¼ã‚¿ãƒ–ï¼ˆéãƒ­ã‚°ã‚¤ãƒ³æ™‚ï¼‰ -->
        <section id="auth" class="tab-content active">
            <div class="card auth-forms">
                <div class="auth-tabs">
                    <div class="auth-tab active" data-auth-form="login">ãƒ­ã‚°ã‚¤ãƒ³</div>
                    <div class="auth-tab" data-auth-form="register">æ–°è¦ç™»éŒ²</div>
                </div>
                
                <div id="login-form" class="auth-form active">
                    <h2>ãƒ­ã‚°ã‚¤ãƒ³</h2>
                    <form id="login-form-element">
                        <div class="form-group">
                            <label for="login-email">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
                            <input type="email" id="login-email" required>
                        </div>
                        <div class="form-group">
                            <label for="login-password">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
                            <input type="password" id="login-password" required>
                        </div>
                        <button type="submit" class="btn btn-success">ãƒ­ã‚°ã‚¤ãƒ³</button>
                    </form>
                </div>
                
                <div id="register-form" class="auth-form">
                    <h2>æ–°è¦ç™»éŒ²</h2>
                    <form id="register-form-element">
                        <div class="form-group">
                            <label for="register-name">ãƒ¦ãƒ¼ã‚¶ãƒ¼å</label>
                            <input type="text" id="register-name" required>
                        </div>
                        <div class="form-group">
                            <label for="register-email">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
                            <input type="email" id="register-email" required>
                        </div>
                        <div class="form-group">
                            <label for="register-password">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
                            <input type="password" id="register-password" required minlength="6">
                        </div>
                        <button type="submit" class="btn btn-success">ç™»éŒ²</button>
                    </form>
                </div>
            </div>
        </section>

        <!-- ã‚¢ãƒ«ãƒãƒ ä½œæˆã‚¿ãƒ– -->
        <section id="create-album" class="tab-content">
            <div class="card">
                <h2>æ–°ã—ã„ã‚¢ãƒ«ãƒãƒ ã‚’ä½œæˆ</h2>
                <form id="album-form">
                    <div class="form-group">
                        <label for="album-title">ã‚¢ãƒ«ãƒãƒ ã‚¿ã‚¤ãƒˆãƒ«</label>
                        <input type="text" id="album-title" required>
                    </div>
                    <div class="form-group">
                        <label for="album-description">èª¬æ˜</label>
                        <textarea id="album-description" rows="3"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label>ç”»åƒã‚’è¿½åŠ </label>
                        <div class="upload-area" id="upload-area">
                            <i>ğŸ“</i>
                            <p>ã‚¯ãƒªãƒƒã‚¯ã—ã¦ç”»åƒã‚’é¸æŠã€ã¾ãŸã¯ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—</p>
                            <input type="file" id="file-input" multiple accept="image/*" style="display: none;">
                        </div>
                        <div class="image-preview" id="image-preview"></div>
                    </div>
                    
                    <button type="submit" class="btn btn-success">ã‚¢ãƒ«ãƒãƒ ã‚’ä½œæˆ</button>
                </form>
            </div>
        </section>

        <!-- ãƒã‚¤ã‚¢ãƒ«ãƒãƒ ã‚¿ãƒ– -->
        <section id="my-albums" class="tab-content">
            <div class="card">
                <h2>ãƒã‚¤ã‚¢ãƒ«ãƒãƒ </h2>
                <div class="album-grid" id="album-grid">
                    <!-- ã‚¢ãƒ«ãƒãƒ ã‚«ãƒ¼ãƒ‰ãŒã“ã“ã«å‹•çš„ã«è¿½åŠ ã•ã‚Œã¾ã™ -->
                </div>
            </div>
        </section>

        <!-- å…±æœ‰ã‚¢ãƒ«ãƒãƒ é–²è¦§ã‚¿ãƒ– -->
        <section id="shared-album" class="tab-content">
            <div class="card">
                <div class="shared-album-view" id="shared-album-view">
                    <!-- å…±æœ‰ã‚¢ãƒ«ãƒãƒ ã®å†…å®¹ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
                </div>
            </div>
        </section>
    </main>

    <!-- ã‚¢ãƒ«ãƒãƒ è¡¨ç¤ºãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div class="modal" id="album-modal">
        <div class="modal-content">
            <button class="close-modal" id="close-modal">&times;</button>
            <div class="album-view">
                <div class="album-images" id="modal-album-images">
                    <!-- ã‚¢ãƒ«ãƒãƒ ç”»åƒãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
                </div>
                <div class="album-details">
                    <h2 id="modal-album-title">ã‚¢ãƒ«ãƒãƒ ã‚¿ã‚¤ãƒˆãƒ«</h2>
                    <p id="modal-album-description">ã‚¢ãƒ«ãƒãƒ ã®èª¬æ˜</p>
                    <p id="modal-album-date">ä½œæˆæ—¥: 2023å¹´10æœˆ1æ—¥</p>
                    
                    <h3>å…±æœ‰</h3>
                    <div class="share-options">
                        <a href="#" class="share-btn twitter" id="share-twitter" target="_blank">Twitter</a>
                        <a href="#" class="share-btn facebook" id="share-facebook" target="_blank">Facebook</a>
                        <a href="#" class="share-btn line" id="share-line" target="_blank">LINE</a>
                        <button class="share-btn copy-link" id="copy-link">ãƒªãƒ³ã‚¯ã‚’ã‚³ãƒ”ãƒ¼</button>
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <button class="btn btn-danger" id="delete-album">ã‚¢ãƒ«ãƒãƒ ã‚’å‰Šé™¤</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ã‚¢ãƒ—ãƒªã®çŠ¶æ…‹ã‚’ç®¡ç†
        const state = {
            currentUser: JSON.parse(localStorage.getItem('currentUser')) || null,
            users: JSON.parse(localStorage.getItem('users')) || [],
            albums: JSON.parse(localStorage.getItem('albums')) || [],
            currentImages: [],
            currentAlbumId: null
        };

        // ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ«ãƒãƒ ãƒ‡ãƒ¼ã‚¿ï¼ˆãƒ‡ãƒ¢ç”¨ï¼‰
        const sampleAlbums = [
            {
                id: "sample-album-1",
                title: "ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ«ãƒãƒ ",
                description: "ã“ã‚Œã¯å…±æœ‰ãƒªãƒ³ã‚¯ã®å‹•ä½œã‚’ç¢ºèªã™ã‚‹ãŸã‚ã®ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ«ãƒãƒ ã§ã™",
                images: [
                    "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iIzRhNmZhNSIvPgogIDx0ZXh0IHg9IjEwMCIgeT0iMTAwIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTgiIGZpbGw9IndoaXRlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkeT0iLjNlbSI+U2FtcGxlIEltYWdlPC90ZXh0Pgo8L3N2Zz4K",
                    "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iIzZiOGNiYyIvPgogIDx0ZXh0IHg9IjEwMCIgeT0iMTAwIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTgiIGZpbGw9IndoaXRlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkeT0iLjNlbSI+U2FtcGxlIDI8L3RleHQ+Cjwvc3ZnPgo=",
                    "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iIzI4YTc0NSIvPgogIDx0ZXh0IHg9IjEwMCIgeT0iMTAwIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTgiIGZpbGw9IndoaXRlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkeT0iLjNlbSI+U2FtcGxlIDM8L3RleHQ+Cjwvc3ZnPgo="
                ],
                creatorId: "sample-user",
                creatorName: "ã‚µãƒ³ãƒ—ãƒ«ãƒ¦ãƒ¼ã‚¶ãƒ¼",
                createdAt: "2023å¹´10æœˆ1æ—¥"
            }
        ];

        // åˆå›èµ·å‹•æ™‚ã«ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ«ãƒãƒ ã‚’è¿½åŠ 
        if (state.albums.length === 0) {
            state.albums = [...sampleAlbums];
            localStorage.setItem('albums', JSON.stringify(state.albums));
        }

        // DOMè¦ç´ ã®å–å¾—
        const userInfo = document.getElementById('user-info');
        const navTabs = document.getElementById('nav-tabs');
        const tabContents = document.querySelectorAll('.tab-content');
        const authTabs = document.querySelectorAll('.auth-tab');
        const authForms = document.querySelectorAll('.auth-form');
        const loginForm = document.getElementById('login-form-element');
        const registerForm = document.getElementById('register-form-element');
        const albumForm = document.getElementById('album-form');
        const uploadArea = document.getElementById('upload-area');
        const fileInput = document.getElementById('file-input');
        const imagePreview = document.getElementById('image-preview');
        const albumGrid = document.getElementById('album-grid');
        const albumModal = document.getElementById('album-modal');
        const closeModal = document.getElementById('close-modal');
        const modalAlbumTitle = document.getElementById('modal-album-title');
        const modalAlbumDescription = document.getElementById('modal-album-description');
        const modalAlbumDate = document.getElementById('modal-album-date');
        const modalAlbumImages = document.getElementById('modal-album-images');
        const deleteAlbumBtn = document.getElementById('delete-album');
        const shareTwitter = document.getElementById('share-twitter');
        const shareFacebook = document.getElementById('share-facebook');
        const shareLine = document.getElementById('share-line');
        const copyLinkBtn = document.getElementById('copy-link');
        const sharedAlbumView = document.getElementById('shared-album-view');

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', () => {
            updateUI();
            checkUrlForSharedAlbum();
            setupAuthTabs();
        });

        // èªè¨¼ã‚¿ãƒ–ã®è¨­å®š
        function setupAuthTabs() {
            authTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const formId = tab.getAttribute('data-auth-form');
                    
                    // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚¿ãƒ–ã‚’æ›´æ–°
                    authTabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    // ãƒ•ã‚©ãƒ¼ãƒ ã‚’è¡¨ç¤º
                    authForms.forEach(form => {
                        form.classList.remove('active');
                        if (form.id === `${formId}-form`) {
                            form.classList.add('active');
                        }
                    });
                });
            });
        }

        // ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ ã®é€ä¿¡
        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            
            const user = state.users.find(u => u.email === email && u.password === password);
            
            if (user) {
                state.currentUser = user;
                localStorage.setItem('currentUser', JSON.stringify(user));
                updateUI();
                showAlert('ãƒ­ã‚°ã‚¤ãƒ³ã«æˆåŠŸã—ã¾ã—ãŸï¼', 'success');
            } else {
                showAlert('ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“', 'error');
            }
        });

        // ç™»éŒ²ãƒ•ã‚©ãƒ¼ãƒ ã®é€ä¿¡
        registerForm.addEventListener('submit', (e) => {
            e.preventDefault();
            
            const name = document.getElementById('register-name').value;
            const email = document.getElementById('register-email').value;
            const password = document.getElementById('register-password').value;
            
            // ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®é‡è¤‡ãƒã‚§ãƒƒã‚¯
            if (state.users.find(u => u.email === email)) {
                showAlert('ã“ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯æ—¢ã«ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã™', 'error');
                return;
            }
            
            const newUser = {
                id: Date.now().toString(),
                name,
                email,
                password
            };
            
            state.users.push(newUser);
            localStorage.setItem('users', JSON.stringify(state.users));
            
            state.currentUser = newUser;
            localStorage.setItem('currentUser', JSON.stringify(newUser));
            
            updateUI();
            showAlert('ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒä½œæˆã•ã‚Œã¾ã—ãŸï¼', 'success');
        });

        // ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
        function logout() {
            state.currentUser = null;
            localStorage.removeItem('currentUser');
            updateUI();
            showAlert('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸ', 'success');
        }

        // UIã®æ›´æ–°
        function updateUI() {
            // ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®è¡¨ç¤º
            if (state.currentUser) {
                userInfo.innerHTML = `
                    <span>${state.currentUser.name} ã•ã‚“</span>
                    <button class="btn btn-warning" id="logout-btn">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
                `;
                
                document.getElementById('logout-btn').addEventListener('click', logout);
                
                // ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚¿ãƒ–
                navTabs.innerHTML = `
                    <li><a href="#" class="nav-link active" data-tab="create-album">ã‚¢ãƒ«ãƒãƒ ä½œæˆ</a></li>
                    <li><a href="#" class="nav-link" data-tab="my-albums">ãƒã‚¤ã‚¢ãƒ«ãƒãƒ </a></li>
                `;
                
                // ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„
                document.getElementById('auth').classList.remove('active');
                document.getElementById('create-album').classList.add('active');
                
                // ã‚¢ãƒ«ãƒãƒ ã‚’è¡¨ç¤º
                renderAlbums();
            } else {
                userInfo.innerHTML = '<span>ã‚²ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼</span>';
                
                // ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚¿ãƒ–
                navTabs.innerHTML = '';
                
                // ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„
                tabContents.forEach(content => content.classList.remove('active'));
                document.getElementById('auth').classList.add('active');
                
                // ã‚¢ãƒ«ãƒãƒ ã‚°ãƒªãƒƒãƒ‰ã‚’ã‚¯ãƒªã‚¢
                albumGrid.innerHTML = '';
            }
            
            // ã‚¿ãƒ–ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®å†è¨­å®š
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', handleTabClick);
            });
        }

        // ã‚¢ãƒ©ãƒ¼ãƒˆè¡¨ç¤º
        function showAlert(message, type) {
            // æ—¢å­˜ã®ã‚¢ãƒ©ãƒ¼ãƒˆã‚’å‰Šé™¤
            const existingAlert = document.querySelector('.alert');
            if (existingAlert) {
                existingAlert.remove();
            }
            
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            
            document.querySelector('.container').insertBefore(alert, document.querySelector('main'));
            
            // 5ç§’å¾Œã«ã‚¢ãƒ©ãƒ¼ãƒˆã‚’å‰Šé™¤
            setTimeout(() => {
                if (alert.parentNode) {
                    alert.remove();
                }
            }, 5000);
        }

        // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦å…±æœ‰ã‚¢ãƒ«ãƒãƒ ã‚’è¡¨ç¤º
        function checkUrlForSharedAlbum() {
            const urlParams = new URLSearchParams(window.location.search);
            const albumId = urlParams.get('album');
            
            if (albumId) {
                console.log('å…±æœ‰ãƒªãƒ³ã‚¯ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã—ãŸã€‚ã‚¢ãƒ«ãƒãƒ ID:', albumId);
                
                // å…±æœ‰ã‚¢ãƒ«ãƒãƒ ã‚’è¡¨ç¤º
                showSharedAlbum(albumId);
                
                // å…±æœ‰ã‚¢ãƒ«ãƒãƒ ã‚¿ãƒ–ã‚’è¿½åŠ ï¼ˆã¾ã ãªã„å ´åˆï¼‰
                if (!document.querySelector('[data-tab="shared-album"]')) {
                    const sharedTab = document.createElement('li');
                    sharedTab.innerHTML = '<a href="#" class="nav-link active" data-tab="shared-album">å…±æœ‰ã‚¢ãƒ«ãƒãƒ </a>';
                    navTabs.appendChild(sharedTab);
                    
                    // æ–°ã—ã„ã‚¿ãƒ–ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¿½åŠ 
                    document.querySelector('[data-tab="shared-album"]').addEventListener('click', handleTabClick);
                }
                
                // ã‚¿ãƒ–ã‚’åˆ‡ã‚Šæ›¿ãˆ
                switchTab('shared-album');
            }
        }

        // å…±æœ‰ã‚¢ãƒ«ãƒãƒ ã‚’è¡¨ç¤º
        function showSharedAlbum(albumId) {
            // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰ã‚¢ãƒ«ãƒãƒ ã‚’å–å¾—
            const storedAlbums = JSON.parse(localStorage.getItem('albums')) || [];
            const album = storedAlbums.find(a => a.id === albumId);
            
            console.log('æ¤œç´¢ä¸­ã®ã‚¢ãƒ«ãƒãƒ ID:', albumId);
            console.log('ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®ã‚¢ãƒ«ãƒãƒ :', storedAlbums);
            
            if (!album) {
                sharedAlbumView.innerHTML = `
                    <div class="empty-state">
                        <i>âŒ</i>
                        <h2>ã‚¢ãƒ«ãƒãƒ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</h2>
                        <p>å‰Šé™¤ã•ã‚ŒãŸã‹ã€URLãŒé–“é•ã£ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚</p>
                        <p><strong>ç¾åœ¨ã®URL:</strong> ${window.location.href}</p>
                        <p><strong>æ¤œç´¢ä¸­ã®ã‚¢ãƒ«ãƒãƒ ID:</strong> ${albumId}</p>
                        <p><strong>åˆ©ç”¨å¯èƒ½ãªã‚¢ãƒ«ãƒãƒ ID:</strong> ${storedAlbums.map(a => a.id).join(', ')}</p>
                        <a href="#" class="btn" id="back-to-app" style="margin-top: 15px;">ã‚¢ãƒ—ãƒªã«æˆ»ã‚‹</a>
                    </div>
                `;
            } else {
                sharedAlbumView.innerHTML = `
                    <h1 class="shared-album-title">${album.title}</h1>
                    <p class="shared-album-description">${album.description || 'èª¬æ˜ãªã—'}</p>
                    <p class="shared-album-meta">ä½œæˆè€…: ${album.creatorName} | ä½œæˆæ—¥: ${album.createdAt} | ${album.images.length}æšã®ç”»åƒ</p>
                    <div class="shared-album-images">
                        ${album.images.map(img => `<img src="${img}" alt="${album.title}">`).join('')}
                    </div>
                    <div style="margin-top: 30px;">
                        <a href="#" class="btn" id="back-to-app">ã‚¢ãƒ—ãƒªã«æˆ»ã‚‹</a>
                    </div>
                `;
            }
            
            document.getElementById('back-to-app').addEventListener('click', (e) => {
                e.preventDefault();
                // URLã‹ã‚‰ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å‰Šé™¤
                window.history.replaceState({}, document.title, window.location.pathname);
                // é©åˆ‡ãªã‚¿ãƒ–ã«æˆ»ã‚‹
                if (state.currentUser) {
                    switchTab('my-albums');
                } else {
                    switchTab('auth');
                }
            });
        }

        // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆé–¢æ•°
        function switchTab(tabName) {
            // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚¿ãƒ–ã‚’æ›´æ–°
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            const targetTab = document.querySelector(`[data-tab="${tabName}"]`);
            if (targetTab) {
                targetTab.classList.add('active');
            }
            
            // ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’è¡¨ç¤º
            tabContents.forEach(content => {
                content.classList.remove('active');
                if (content.id === tabName) {
                    content.classList.add('active');
                }
            });
            
            // ãƒã‚¤ã‚¢ãƒ«ãƒãƒ ã‚¿ãƒ–ã‚’è¡¨ç¤ºã™ã‚‹å ´åˆã¯ã‚¢ãƒ«ãƒãƒ ã‚’å†èª­ã¿è¾¼ã¿
            if (tabName === 'my-albums') {
                renderAlbums();
            }
        }

        // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
        function handleTabClick(e) {
            e.preventDefault();
            const targetTab = this.getAttribute('data-tab');
            switchTab(targetTab);
        }

        // ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã®å‡¦ç†
        uploadArea.addEventListener('click', () => {
            fileInput.click();
        });

        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = '#4a6fa5';
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.style.borderColor = '#ddd';
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = '#ddd';
            
            if (e.dataTransfer.files.length > 0) {
                handleFiles(e.dataTransfer.files);
            }
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFiles(e.target.files);
            }
        });

        // ãƒ•ã‚¡ã‚¤ãƒ«å‡¦ç†é–¢æ•°
        function handleFiles(files) {
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                if (!file.type.match('image.*')) continue;
                
                const reader = new FileReader();
                
                reader.onload = (e) => {
                    const imgSrc = e.target.result;
                    state.currentImages.push(imgSrc);
                    renderImagePreviews();
                };
                
                reader.readAsDataURL(file);
            }
        }

        // ç”»åƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®è¡¨ç¤º
        function renderImagePreviews() {
            imagePreview.innerHTML = '';
            
            if (state.currentImages.length === 0) {
                return;
            }
            
            state.currentImages.forEach((imgSrc, index) => {
                const previewItem = document.createElement('div');
                previewItem.className = 'preview-item';
                
                const img = document.createElement('img');
                img.src = imgSrc;
                
                const removeBtn = document.createElement('button');
                removeBtn.className = 'remove';
                removeBtn.innerHTML = 'Ã—';
                removeBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    state.currentImages.splice(index, 1);
                    renderImagePreviews();
                });
                
                previewItem.appendChild(img);
                previewItem.appendChild(removeBtn);
                imagePreview.appendChild(previewItem);
            });
        }

        // ã‚¢ãƒ«ãƒãƒ ä½œæˆãƒ•ã‚©ãƒ¼ãƒ ã®é€ä¿¡
        albumForm.addEventListener('submit', (e) => {
            e.preventDefault();
            
            if (!state.currentUser) {
                showAlert('ã‚¢ãƒ«ãƒãƒ ã‚’ä½œæˆã™ã‚‹ã«ã¯ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„', 'error');
                return;
            }
            
            const title = document.getElementById('album-title').value;
            const description = document.getElementById('album-description').value;
            
            if (state.currentImages.length === 0) {
                showAlert('å°‘ãªãã¨ã‚‚1æšã®ç”»åƒã‚’è¿½åŠ ã—ã¦ãã ã•ã„', 'error');
                return;
            }
            
            const newAlbum = {
                id: Date.now().toString(),
                title,
                description,
                images: [...state.currentImages],
                creatorId: state.currentUser.id,
                creatorName: state.currentUser.name,
                createdAt: new Date().toLocaleDateString('ja-JP')
            };
            
            state.albums.push(newAlbum);
            saveAlbums();
            
            // ãƒ•ã‚©ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆ
            albumForm.reset();
            state.currentImages = [];
            renderImagePreviews();
            
            showAlert('ã‚¢ãƒ«ãƒãƒ ãŒä½œæˆã•ã‚Œã¾ã—ãŸï¼', 'success');
            
            // ãƒã‚¤ã‚¢ãƒ«ãƒãƒ ã‚¿ãƒ–ã«åˆ‡ã‚Šæ›¿ãˆ
            switchTab('my-albums');
        });

        // ã‚¢ãƒ«ãƒãƒ ã®è¡¨ç¤º
        function renderAlbums() {
            albumGrid.innerHTML = '';
            
            const userAlbums = state.albums.filter(album => album.creatorId === state.currentUser.id);
            
            if (userAlbums.length === 0) {
                albumGrid.innerHTML = `
                    <div class="empty-state" style="grid-column: 1 / -1;">
                        <i>ğŸ“·</i>
                        <h2>ã‚¢ãƒ«ãƒãƒ ãŒã‚ã‚Šã¾ã›ã‚“</h2>
                        <p>æ–°ã—ã„ã‚¢ãƒ«ãƒãƒ ã‚’ä½œæˆã—ã¾ã—ã‚‡ã†ï¼</p>
                    </div>
                `;
                return;
            }
            
            userAlbums.forEach(album => {
                const albumCard = document.createElement('div');
                albumCard.className = 'album-card';
                
                albumCard.innerHTML = `
                    <div class="album-thumbnail">
                        <img src="${album.images[0]}" alt="${album.title}">
                    </div>
                    <div class="album-info">
                        <h3>${album.title}</h3>
                        <p>${album.description || 'èª¬æ˜ãªã—'}</p>
                        <p>${album.images.length}æšã®ç”»åƒ</p>
                        <div class="album-actions">
                            <button class="btn view-album" data-id="${album.id}">è¡¨ç¤º</button>
                            <button class="btn btn-danger delete-album" data-id="${album.id}">å‰Šé™¤</button>
                        </div>
                    </div>
                `;
                
                albumGrid.appendChild(albumCard);
            });
            
            // ã‚¢ãƒ«ãƒãƒ è¡¨ç¤ºã‚¤ãƒ™ãƒ³ãƒˆã®è¨­å®š
            document.querySelectorAll('.view-album').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const albumId = e.target.getAttribute('data-id');
                    openAlbumModal(albumId);
                });
            });
            
            // ã‚¢ãƒ«ãƒãƒ å‰Šé™¤ã‚¤ãƒ™ãƒ³ãƒˆã®è¨­å®š
            document.querySelectorAll('.delete-album').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const albumId = e.target.getAttribute('data-id');
                    if (confirm('ã“ã®ã‚¢ãƒ«ãƒãƒ ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                        deleteAlbum(albumId);
                    }
                });
            });
        }

        // ã‚¢ãƒ«ãƒãƒ ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ã
        function openAlbumModal(albumId) {
            const album = state.albums.find(a => a.id === albumId);
            if (!album) return;
            
            state.currentAlbumId = albumId;
            modalAlbumTitle.textContent = album.title;
            modalAlbumDescription.textContent = album.description || 'èª¬æ˜ãªã—';
            modalAlbumDate.textContent = `ä½œæˆæ—¥: ${album.createdAt}`;
            
            // ã‚¢ãƒ«ãƒãƒ ç”»åƒã®è¡¨ç¤º
            modalAlbumImages.innerHTML = '';
            album.images.forEach(imgSrc => {
                const img = document.createElement('img');
                img.src = imgSrc;
                modalAlbumImages.appendChild(img);
            });
            
            // å…±æœ‰ãƒªãƒ³ã‚¯ã®è¨­å®š - GitHub Pagesç”¨ã«çµ¶å¯¾URLã‚’ä½¿ç”¨
            const baseUrl = window.location.origin + window.location.pathname;
            const shareUrl = `${baseUrl}?album=${albumId}`;
            const shareText = `${album.creatorName}ã•ã‚“ã®ã‚¢ãƒ«ãƒãƒ ã€Œ${album.title}ã€ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼`;
            
            shareTwitter.href = `https://twitter.com/intent/tweet?url=${encodeURIComponent(shareUrl)}&text=${encodeURIComponent(shareText)}`;
            shareFacebook.href = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(shareUrl)}`;
            shareLine.href = `https://social-plugins.line.me/lineit/share?url=${encodeURIComponent(shareUrl)}`;
            
            copyLinkBtn.onclick = () => {
                navigator.clipboard.writeText(shareUrl).then(() => {
                    showAlert('ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼', 'success');
                }).catch(() => {
                    // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
                    const textArea = document.createElement('textarea');
                    textArea.value = shareUrl;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    showAlert('ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼', 'success');
                });
            };
            
            albumModal.style.display = 'flex';
        }

        // ã‚¢ãƒ«ãƒãƒ ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
        closeModal.addEventListener('click', () => {
            albumModal.style.display = 'none';
        });

        // ã‚¢ãƒ«ãƒãƒ ã®å‰Šé™¤
        deleteAlbumBtn.addEventListener('click', () => {
            if (confirm('ã“ã®ã‚¢ãƒ«ãƒãƒ ã‚’å®Œå…¨ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å…ƒã«æˆ»ã›ã¾ã›ã‚“ã€‚')) {
                deleteAlbum(state.currentAlbumId);
                albumModal.style.display = 'none';
            }
        });

        // ã‚¢ãƒ«ãƒãƒ å‰Šé™¤é–¢æ•°
        function deleteAlbum(albumId) {
            state.albums = state.albums.filter(album => album.id !== albumId);
            saveAlbums();
            renderAlbums();
        }

        // ã‚¢ãƒ«ãƒãƒ ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
        function saveAlbums() {
            localStorage.setItem('albums', JSON.stringify(state.albums));
        }
    </script>
</body>
</html>